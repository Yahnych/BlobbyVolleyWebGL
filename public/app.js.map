{"version":3,"sources":["app/assetManager.js","app/ball.js","app/blob.js","app/eventEmitter.js","app/field.js","app/keyboardState.js","app/main.js","app/party.js","app/physics.js","app/player.js","app/rules.js","app/screensManager.js","app/sound.js"],"names":["AssetManager","assets","loadingManager","LoadingManager","onLoad","_loaded","bind","onProgress","_progressing","onError","_error","textureLoader","TextureLoader","args","dispatch","loadTexture","path","load","texture","set","replace","has","get","asset","Ball","world","color","spawnPosition","radius","maxSpeed","fixture","material","threeObject","sound","_isHavingContact","_isTouchingGround","init","body","Body","mass","position","userData","shape","Circle","addShape","setDensity","Material","addBody","on","event","bodyA","bodyB","window","assetManager","geometry","SphereGeometry","MeshPhongMaterial","map","bumpMap","bumpScale","Mesh","rotation","x","Math","PI","getFixture","physics","pos","velocity","speed","vec2","length","y","hasTouchingContact","play","isTouchingGround","moveTo","Blob","jumpAllowed","_isTouchingBall","fixedRotation","CylinderGeometry","MeshBasicMaterial","move","handleJump","vel","velDelta","force","applyForce","yVelocity","applyImpulse","fromValues","isTouchingBall","EventEmitter","listeners","eventName","listener","push","i","Field","width","height","dims","parts","materials","ground","createWall","leftWall","rightWall","net","bg","PlaneGeometry","z","depth","opacity","Box","physicsMaterial","BoxGeometry","isNumber","Texture","transparent","isUndefined","mesh","getWorld","getPosition","getDims","getParts","KeyboardState","element","target","document","pressedKeys","Set","_onKeydownBound","_onKeydown","_onKeyupBound","_onKeyup","addEventListener","add","key","delete","pressed","destroy","removeEventListener","OrbitControls","require","fixedTimeStep","maxSubSteps","lastTime","camera","scene","renderer","stats","container","party","request","initialized","screens","getElementById","screenManager","scoreLeftDisplay","scoreRightDisplay","serviceDisplay","scoreNeededToWinDisplay","maximumContactsAllowedDisplay","videoParameterElements","querySelectorAll","controlsElements","rulesElements","initPlayerControls","rules","debug","goTo","loadGame","initGame","component","error","getScreen","classList","Scene","PerspectiveCamera","innerWidth","innerHeight","WebGLRenderer","antialias","setSize","setClearColor","clear","appendChild","domElement","controls","render","style","top","keyCode","pauseGame","preventDefault","e","displayFlashMessage","detail","message","updateScoreUI","onChange","input","value","name","getAttribute","enabled","toggle","config","forEach","item","parameter","isNull","onchange","keydownOnInputControl","includes","player","parseInt","controlName","players","setControlForKey","onkeydown","ruleValue","ruleName","onkeyup","newParty","hide","updateRulesUI","newGame","inProgress","pauseState","pause","textContent","scoreToWin","maximumContactsAllowed","winSide","side","scores","left","right","className","charAt","toUpperCase","slice","renderLoop","time","requestAnimationFrame","deltaTime","update","cancelAnimationFrame","Party","playersConfig","field","ball","paused","lockPause","playingSide","servingSide","resetScore","each","keyboard","clearScene","children","obj","remove","dispatchEvent","CustomEvent","light","HemisphereLight","index","playerConfig","blob","attachBlob","_declareMaterialsInteractions","meshes","getBlob","endGame","invert","max","values","afterScoring","resetObjects","incrementScore","maxScore","minScore","min","delay","Error","Boolean","applyRules","listenInput","step","resetTouches","currentTouches","addContactMaterial","ContactMaterial","friction","restitution","Physics","gravity","World","Player","setControls","keyBinding","getControlsAntagonistKey","antagonists","control","antagonistControl","moveBlob","detachBlob","Rules","defaultConfig","extend","ScreenManager","flashMessageElement","flashMessageTextElement","HTMLElement","history","screen","displayScreen","goBack","previousScreen","pop","display","duration","fadeIn","setTimeout","fadeOut","el","last","Date","tick","Sound","sources","audio","throttle","_play","leading","createElement","source","src","getAudio","restart","currentTime","stop"],"mappings":"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","file":"public/app.js","sourcesContent":["import EventEmitter from './eventEmitter';\nimport THREE from 'three';\nimport _ from 'lodash';\n\nexport default class AssetManager extends EventEmitter {\n    constructor () {\n        super();\n\n        this.assets = {};\n        this.loadingManager = new THREE.LoadingManager();\n        this.loadingManager.onLoad = this._loaded.bind(this);\n        this.loadingManager.onProgress = this._progressing.bind(this);\n        this.loadingManager.onError = this._error.bind(this);\n        this.textureLoader = new THREE.TextureLoader(this.loadingManager);\n    }\n\n    _loaded (...args) {\n        this.dispatch('loaded', ...args);\n    }\n\n    _progressing (...args) {\n        this.dispatch('progress', ...args);\n    }\n\n    _error (...args) {\n        this.dispatch('error', ...args);\n    }\n\n    loadTexture (path) {\n        this.textureLoader.load(\n            path,\n            (texture) => this.set(path.replace(/\\.[^.]+$/, '').replace('/', '.'), texture)\n        );\n    }\n\n    has (path) {\n        return _.has(this.assets, path);\n    }\n\n    get (path) {\n        return _.get(this.assets, path);\n    }\n\n    set (path, asset) {\n        _.set(this.assets, path, asset);\n        return this;\n    }\n}\n","import THREE from 'three';\nimport Sound from './sound';\nimport p2 from 'p2';\n\nexport default class Ball {\n    constructor (world, color, spawnPosition) {\n        this.world = world;\n        this.color = color;\n        this.spawnPosition = spawnPosition;\n        this.radius = 1.1; // TODO : If we reduce the radius the ball can be stuck against a wall and the blob can't move it\n        this.maxSpeed = 12;\n        this.fixture = null;\n        this.material = null;\n        this.threeObject = null;\n        this.sound = null;\n        this._isHavingContact = false;\n        this._isTouchingGround = false;\n\n        this.init();\n    }\n\n    init () {\n        const body = new p2.Body({\n            mass: 1,\n            position: this.spawnPosition\n        });\n\n        body.userData = 'type_ball';\n\n        const shape = new p2.Circle({\n            radius: this.radius\n        });\n\n        body.addShape(shape);\n        body.setDensity(1);\n\n        this.material = new p2.Material();\n        shape.material = this.material;\n\n        this.world.addBody(body);\n        this.fixture = body;\n\n        this.world.on('beginContact', function (event) {\n            if (event.bodyA !== body && event.bodyB !== body) {\n                return;\n            }\n\n            this._isHavingContact = true;\n\n            if (\n                event.bodyA.userData === 'type_ground' ||\n                event.bodyB.userData === 'type_ground'\n            ) {\n                this._isTouchingGround = true;\n            }\n        }.bind(this));\n\n        this.world.on('endContact', function (event) {\n            if (event.bodyA !== body && event.bodyB !== body) {\n                return;\n            }\n\n            this._isHavingContact = false;\n\n            if (\n                event.bodyA.userData === 'type_ground' ||\n                event.bodyB.userData === 'type_ground'\n            ) {\n                this._isTouchingGround = false;\n            }\n        }.bind(this));\n\n        const texture = window.assetManager.get('textures.ball');\n        const geometry = new THREE.SphereGeometry(this.radius, 64, 64);\n        const material = new THREE.MeshPhongMaterial({\n            map: texture,\n            bumpMap: texture,\n            bumpScale: 0.01\n        });\n        this.threeObject = new THREE.Mesh(geometry, material);\n        this.threeObject.rotation.x += 90 * Math.PI / 180;\n\n        this.sound = new Sound(['sounds/ball.mp3', 'sounds/ball.ogg']);\n    }\n\n    getFixture () {\n        return this.fixture;\n    }\n\n    physics () {\n        const body = this.fixture,\n            pos = body.position,\n            velocity = body.velocity,\n            speed = p2.vec2.length(velocity);\n\n        if (speed > this.maxSpeed) {\n            body.velocity = [\n                this.maxSpeed / speed * velocity[0],\n                this.maxSpeed / speed * velocity[1]\n            ];\n        }\n\n        this.threeObject.position.x = pos[0];\n        this.threeObject.position.y = pos[1];\n\n        if (this.hasTouchingContact()) {\n            this.sound.play(true);\n        }\n    }\n\n    hasTouchingContact () {\n        return this._isHavingContact;\n    }\n\n    isTouchingGround () {\n        return this._isTouchingGround;\n    }\n\n    moveTo (position) {\n        this.fixture.position = position;\n        this.fixture.velocity = [0, 0];\n    }\n}\n","import THREE from 'three';\nimport p2 from 'p2';\n\nexport default class Blob {\n    constructor (world, color, spawnPosition) {\n        this.world = world;\n        this.color = color;\n        this.spawnPosition = spawnPosition;\n        this.fixture = null;\n        this.material = null;\n        this.threeObject = null;\n        this.radius = 1;\n        this.speed = 5;\n        this.jumpAllowed = false;\n        this._isTouchingGround = false;\n        this._isTouchingBall = false;\n\n        this.init();\n    }\n\n    init () {\n        const body = new p2.Body({\n            mass: 100,\n            fixedRotation: true,\n            position: this.spawnPosition\n        });\n\n        const shape = new p2.Circle({\n            radius: this.radius\n        });\n\n        body.addShape(shape);\n        body.setDensity(100);\n\n        this.material = new p2.Material();\n        shape.material = this.material;\n\n        this.world.addBody(body);\n        this.fixture = body;\n\n        this.world.on('beginContact', function (event) {\n            if (event.bodyA !== body && event.bodyB !== body) {\n                return;\n            }\n\n            if (\n                event.bodyA.userData === 'type_ground' ||\n                event.bodyB.userData === 'type_ground'\n            ) {\n                this._isTouchingGround = true;\n            } else if (\n                event.bodyA.userData === 'type_ball' ||\n                event.bodyB.userData === 'type_ball'\n            ) {\n                this._isTouchingBall = true;\n            }\n        }.bind(this));\n\n        this.world.on('endContact', function (event) {\n            if (event.bodyA !== body && event.bodyB !== body) {\n                return;\n            }\n\n            if (\n                event.bodyA.userData === 'type_ground' ||\n                event.bodyB.userData === 'type_ground'\n            ) {\n                this._isTouchingGround = false;\n            } else if (\n                event.bodyA.userData === 'type_ball' ||\n                event.bodyB.userData === 'type_ball'\n            ) {\n                this._isTouchingBall = false;\n            }\n        }.bind(this));\n\n        const geometry = new THREE.CylinderGeometry(this.radius, this.radius, 1, 7, 1, false);\n        const material = new THREE.MeshBasicMaterial({ color: this.color });\n        this.threeObject = new THREE.Mesh(geometry, material);\n        this.threeObject.rotation.x += 90 * Math.PI / 180;\n    }\n\n    getFixture () {\n        return this.fixture;\n    }\n\n    move (x, y) {\n        // Vertical jump\n        if (y > 0) {\n            this.handleJump();\n        }\n\n\n        // Horizontal move\n        if (x !== 0) {\n            const body = this.fixture,\n                vel = body.velocity,\n                velDelta = (this.speed * x) - vel[0],\n                force = body.mass * velDelta / (1 / 60); // TODO 1/60 could change (see main)\n\n            body.applyForce(\n                [force, 0]\n            );\n        }\n    }\n\n    handleJump () {\n        const body = this.fixture,\n            yVelocity = body.velocity[1];\n\n        // Allow jumping\n        if (!this.jumpAllowed && yVelocity < 0.00001 && this.isTouchingGround()) {\n            this.jumpAllowed = true;\n        }\n\n        // Jumping\n        if (this.jumpAllowed) {\n            body.applyImpulse(\n                p2.vec2.fromValues(0, 9 * this.fixture.mass)\n            );\n\n            // Prevent jumping\n            this.jumpAllowed = false;\n        }\n    }\n\n    isTouchingGround () {\n        return this._isTouchingGround;\n    }\n\n    isTouchingBall () {\n        return this._isTouchingBall;\n    }\n\n    physics () {\n        const pos = this.fixture.position;\n        this.threeObject.position.x = pos[0];\n        this.threeObject.position.y = pos[1];\n    }\n\n    moveTo (position) {\n        this.fixture.position = position;\n        this.fixture.velocity = [0, 0];\n    }\n}\n","export default class EventEmitter {\n    constructor () {\n        this.listeners = {};\n    }\n\n    on (eventName, listener) {\n        if (!this.listeners[eventName]) {\n            this.listeners[eventName] = [];\n        }\n\n        this.listeners[eventName].push(listener);\n    }\n\n    dispatch (eventName, ...args) {\n        if (this.listeners[eventName]) {\n            for (let i = 0; i < this.listeners[eventName].length; i++) {\n                this.listeners[eventName][i](this, ...args);\n            }\n        }\n    }\n}\n","import THREE from 'three';\nimport _ from 'lodash';\nimport p2 from 'p2';\n\nexport default class Field {\n    constructor (world, x, y, width, height) {\n        this.world = world;\n        this.x = x;\n        this.y = y;\n        this.width = width;\n        this.height = height;\n        this.position = { x: x, y: y };\n        this.dims = [width, height];\n        this.parts = [];\n        this.materials = [];\n\n        this.init();\n    }\n\n    init () {\n        const ground = this.createWall(\n            this.x,\n            this.y - (this.height / 2) - 0.5,\n            this.width,\n            1,\n            20,\n            window.assetManager.get('textures.wood'),\n            0xEEEEEE,\n            null,\n            'type_ground'\n        );\n\n        const leftWall = this.createWall(\n            this.x - (this.width / 2) - 0.5,\n            this.y + (this.height / 2),\n            1,\n            this.height * 2,\n            20,\n            null,\n            0xDEDEDE,\n            0\n        );\n\n        const rightWall = this.createWall(\n            this.x + (this.width / 2) + 0.5,\n            this.y + (this.height / 2),\n            1,\n            this.height * 2,\n            20,\n            null,\n            0xDEDEDE,\n            0\n        );\n\n        const net = this.createWall(\n            this.x,\n            this.y - (this.height / 2) + (this.height / 4),\n            0.3,\n            this.height / 2,\n            20,\n            null,\n            0xDEDEDE,\n            0.8\n        );\n\n        // Background\n        const bg = new THREE.Mesh(\n            new THREE.PlaneGeometry(110, 90, 0),\n            new THREE.MeshBasicMaterial({map: window.assetManager.get('textures.background')})\n        );\n\n        bg.position.z = -20;\n        bg.position.y = 12;\n\n        this.parts.push(ground, leftWall, rightWall, net, bg);\n    }\n\n    createWall (x, y, width, height, depth, texture, color, opacity, userData) {\n        const body = new p2.Body({\n            mass: 0,\n            position: [x, y]\n        });\n\n        if (typeof userData !== 'undefined') {\n            body.userData = userData;\n        }\n\n        const shape = new p2.Box({\n            width: width,\n            height: height\n        });\n\n        body.addShape(shape);\n        body.setDensity(1);\n\n        const physicsMaterial = new p2.Material();\n\n        shape.material = physicsMaterial;\n        this.materials.push(physicsMaterial);\n\n        this.world.addBody(body);\n\n        const geometry = width > height\n                ? new THREE.BoxGeometry(width, height, _.isNumber(depth) ? depth : 0)\n                : new THREE.BoxGeometry(width, height, _.isNumber(depth) ? depth : 0);\n\n        let material;\n\n        if (texture instanceof THREE.Texture) {\n            material = new THREE.MeshBasicMaterial({\n                map: texture,\n                transparent: true\n            });\n        } else {\n            material = new THREE.MeshBasicMaterial({\n                color: !_.isUndefined(color) ? color : 0x000000,\n                opacity: !_.isUndefined(opacity) ? opacity : 1,\n                transparent: true\n            });\n        }\n\n        const mesh = new THREE.Mesh(\n            geometry,\n            material\n        );\n        mesh.position.x = body.position[0];\n        mesh.position.y = body.position[1];\n\n        return mesh;\n    }\n\n    getWorld () {\n        return this.world;\n    }\n\n    getPosition () {\n        return this.position;\n    }\n\n    getDims () {\n        return this.dims;\n    }\n\n    getParts () {\n        return this.parts;\n    }\n}\n","export default class KeyboardState {\n    constructor (element) {\n        this.target = element || document;\n        this.pressedKeys = new Set();\n        this._onKeydownBound = this._onKeydown.bind(this);\n        this._onKeyupBound = this._onKeyup.bind(this);\n\n        this.target.addEventListener('keydown', this._onKeydownBound, false);\n        this.target.addEventListener('keyup', this._onKeyupBound, false);\n    }\n\n    _onKeydown (event) {\n        this.pressedKeys.add(event.key);\n    }\n\n    _onKeyup (event) {\n        this.pressedKeys.delete(event.key);\n    }\n\n    pressed (key) {\n        return this.pressedKeys.has(key);\n    }\n\n    destroy () {\n        this.target.removeEventListener('keydown', this._onKeydownBound, false);\n        this.target.removeEventListener('keyup', this._onKeyupBound, false);\n    }\n}\n","import _ from 'lodash';\nimport Stats from 'stats.js';\nimport THREE from 'three';\nimport THREExWindowResize from 'three-window-resize';\nimport screenfull from 'screenfull';\nimport ScreenManager from './screensManager';\nimport Party from './party';\nimport Rules from './rules';\nimport AssetManager from './assetManager';\n\nconst OrbitControls = require('three-orbit-controls')(THREE);\n\n// Variables\nconst fixedTimeStep = 1 / 60;\nconst maxSubSteps = 10;\nlet lastTime;\n\nlet camera, scene, renderer, stats, container,\n    party,\n    request,\n    initialized = false;\n\nconst screens = {\n        \"loadingMenu\": document.getElementById(\"loadingMenu\"),\n        \"mainMenu\": document.getElementById(\"mainMenu\"),\n        \"pauseMenu\": document.getElementById(\"pauseMenu\"),\n        \"gameOverMenu\": document.getElementById(\"gameOverMenu\"),\n        \"optionsMenu\": document.getElementById(\"optionsMenu\"),\n        \"videoMenu\": document.getElementById(\"videoMenu\"),\n        \"controlsMenu\": document.getElementById(\"controlsMenu\"),\n        \"rulesMenu\": document.getElementById(\"rulesMenu\")\n    },\n    screenManager = new ScreenManager(\n        screens,\n        document.getElementById(\"flashMessage\"),\n        document.getElementById(\"flashText\")\n    ),\n    assetManager = new AssetManager(),\n    scoreLeftDisplay = document.getElementById(\"scoreLeftDisplay\"),\n    scoreRightDisplay = document.getElementById(\"scoreRightDisplay\"),\n    serviceDisplay = document.getElementById(\"serviceDisplay\"),\n    scoreNeededToWinDisplay = document.getElementById(\"scoreNeededToWinDisplay\"),\n    maximumContactsAllowedDisplay = document.getElementById(\"maximumContactsAllowedDisplay\"),\n    videoParameterElements = screens['videoMenu'].querySelectorAll('.videoParameterElement'),\n    controlsElements = screens['controlsMenu'].querySelectorAll('.controlKey'),\n    rulesElements = screens['rulesMenu'].querySelectorAll('.ruleElement'),\n    initPlayerControls = [\n        {\n            'up': 'z',\n            'right': 'd',\n            'left': 'q'\n        },\n        {\n            'up': 'ArrowUp',\n            'right': 'ArrowRight',\n            'left': 'ArrowLeft'\n        }\n    ],\n    rules = new Rules(),\n    debug = false;\n\n// Bootstrap\ninit();\n\n// Init\nfunction init () {\n    if (initialized) {\n        return;\n    }\n\n    initialized = true;\n\n    // Load game\n    screenManager.goTo(\"loadingMenu\");\n    loadGame();\n}\n\n// Load game\nfunction loadGame () {\n    // Assets\n    assetManager.on('loaded', initGame);\n    assetManager.on('error', (component, error) => {\n        screenManager.getScreen('loadingMenu').classList.add('error');\n        throw error;\n    });\n    assetManager.loadTexture('textures/wood.jpg');\n    assetManager.loadTexture('textures/background.jpg');\n    assetManager.loadTexture('textures/ball.jpg');\n}\n\n// Init game\nfunction initGame () {\n    // Scene\n    scene = new THREE.Scene();\n    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);\n    renderer = new THREE.WebGLRenderer({ antialias: true });\n    renderer.setSize(window.innerWidth, window.innerHeight);\n    renderer.setClearColor(0xffffff, 1);\n    renderer.clear();\n    container = document.body;\n    container.appendChild(renderer.domElement);\n\n    // Camera default position\n    camera.position.set(0, 4, 12);\n    camera.rotation.x = -5 * Math.PI / 180;\n\n    if (debug) {\n        const controls = new OrbitControls( camera );\n        controls.addEventListener( 'change', render );\n    }\n\n    // Window resizing\n    THREExWindowResize(renderer, camera);\n\n    // Stats\n    stats = new Stats();\n    stats.domElement.style.position = 'absolute';\n    stats.domElement.style.top = '0px';\n    container.appendChild(stats.domElement);\n\n    // Pause party (space bar)\n    document.addEventListener('keyup', function (event) {\n        if (event.keyCode === 32) {\n            pauseGame();\n        }\n    });\n\n    /* Events */\n    // Prevent F11 to toggle fullscreen, go to video options instead\n    document.addEventListener('keydown', function (event) {\n        if (event.keyCode === 122) {\n            event.preventDefault();\n            screenManager.goTo('optionsMenu').goTo('videoMenu');\n        }\n    });\n\n    // End game event listener\n    window.addEventListener(\"endGame\", function (e) {\n        screenManager.displayFlashMessage(e.detail.message);\n        pauseGame();\n\n        screenManager.goTo(\"gameOverMenu\");\n    });\n\n    // Score event listener\n    window.addEventListener(\"score\", updateScoreUI);\n\n    // Video menu is displayed, listen keyboard event on inputs\n    screenManager.on(\"videoMenu\", function () {\n        const onChange = function (e) {\n            const input = e.target;\n            const value = input.value;\n            const name = input.getAttribute('data-parameter');\n\n            // Fullscreen\n            if (name === 'fullscreen' && screenfull.enabled) {\n                screenfull.toggle();\n                return;\n            }\n\n            rules.config[name] = value;\n            input.value = value;\n        };\n\n        _.forEach(videoParameterElements, function (item) {\n            const parameter = item.getAttribute('data-parameter');\n            item.value = rules.config[parameter];\n\n            if (_.isNull(item.onchange)) {\n                item.onchange = onChange;\n            }\n        });\n    });\n\n    // Control menu is displayed, listen keyboard event on inputs\n    screenManager.on(\"controlsMenu\", function () {\n        const keydownOnInputControl = function (e) {\n            // Allow keyboard navigation\n            if (_.includes(['Tab', 'Shift'], e.key)) {\n                return;\n            }\n\n            const input = e.target;\n            const player = parseInt(input.getAttribute('data-player'));\n            const controlName = input.getAttribute('data-control');\n\n            input.value = e.key;\n\n            // TODO handle control configuration before the party is initialized\n            initPlayerControls[player][controlName] = e.key;\n\n            if (party) {\n                party.players[player].setControlForKey(controlName, e.key);\n            }\n\n            return false;\n        };\n\n        _.forEach(controlsElements, function (item) {\n            const player = parseInt(item.getAttribute('data-player'));\n            const controlName = item.getAttribute('data-control');\n            item.value = initPlayerControls[player][controlName];\n\n            if (_.isNull(item.onkeydown)) {\n                item.onkeydown = keydownOnInputControl;\n            }\n        });\n    });\n\n    // Rules menu is displayed, listen keyboard event on inputs\n    screenManager.on(\"rulesMenu\", function () {\n        const keydownOnInputControl = function (e) {\n            const input = e.target;\n            const ruleValue = parseInt(input.value);\n            const ruleName = input.getAttribute('data-ruleName');\n            rules.config[ruleName] = ruleValue;\n            input.value = ruleValue;\n        };\n\n        _.forEach(rulesElements, function (item) {\n            const ruleName = item.getAttribute('data-ruleName');\n            item.value = rules.config[ruleName];\n\n            if (_.isNull(item.onkeyup)) {\n                item.onkeyup = keydownOnInputControl;\n            }\n        });\n    });\n\n    // Display main menu\n    screenManager.goTo(\"mainMenu\");\n}\n\nfunction newParty () {\n    screenManager.hide();\n    screenManager.displayFlashMessage(\"Game starts !\");\n\n    updateRulesUI();\n\n    // Party\n    party = new Party(\n        scene,\n        rules,\n        [\n            {\n                name: 'P1',\n                controls: initPlayerControls[0],\n                position: 'left'\n            },\n            {\n                name: 'P2',\n                controls: initPlayerControls[1],\n                position: 'right'\n            }\n        ]\n    );\n    party.newGame();\n\n    render();\n}\n\nfunction pauseGame () {\n    if (!party.inProgress) {\n        return;\n    }\n\n    const pauseState = party.pause();\n\n    if (pauseState) {\n        screenManager.goTo(\"pauseMenu\");\n    } else {\n        screenManager.hide();\n    }\n}\n\nfunction updateRulesUI () {\n    scoreNeededToWinDisplay.textContent = rules.config.scoreToWin;\n    maximumContactsAllowedDisplay.textContent = rules.config.maximumContactsAllowed;\n}\n\nfunction updateScoreUI (event) {\n    const winSide = event.detail.side,\n        scores = event.detail.scores;\n\n    scoreLeftDisplay.textContent = scores.left;\n    scoreRightDisplay.textContent = scores.right;\n    serviceDisplay.className = winSide;\n    serviceDisplay.textContent = winSide.charAt(0).toUpperCase() + winSide.slice(1);\n}\n\n// Animation loop\nfunction renderLoop (time) {\n    request = requestAnimationFrame(renderLoop);\n\n    // Sync physics with time (compute elapsed time since last render frame)\n    const deltaTime = lastTime ? (time - lastTime) / 1000 : 0;\n\n    party.update(fixedTimeStep, deltaTime, maxSubSteps);\n\n    // Update stats\n    stats.update();\n\n    renderer.render(scene, camera);\n}\n\n// Launch animation\nfunction render () {\n    if (!_.isUndefined(request)) {\n        cancelAnimationFrame(request);\n    }\n\n    request = requestAnimationFrame(renderLoop);\n}\n\n// FIXME Do not store into window\nwindow.newParty = newParty;\nwindow.pauseGame = pauseGame;\nwindow.screenManager = screenManager;\nwindow.assetManager = assetManager;\n","import THREE from 'three';\nimport _ from 'lodash';\nimport p2 from 'p2';\n\nimport Ball from './ball';\nimport Blob from './blob';\nimport Field from './field';\nimport Player from './player';\nimport Physics from './physics';\n\nexport default class Party {\n    constructor (scene, rules, playersConfig) {\n        this.scene = scene;\n        this.rules = rules;\n        this.playersConfig = playersConfig;\n        this.physics = null;\n        this.field = null;\n        this.players = null;\n        this.ball = null;\n        this.scores = null;\n        this.paused = false;\n        this.lockPause = false;\n        this.playingSide = null;\n        this.servingSide = null;\n        this.inProgress = null;\n\n        this.init();\n    }\n\n    init () {\n        this.resetScore();\n    }\n\n    clear () {\n        // Clear players\n        _.each(this.players, (player) => player.keyboard.destroy());\n\n        // Clear scene\n        this.clearScene();\n\n        // Reset score\n        this.resetScore();\n    }\n\n    clearScene () {\n        for (let i = this.scene.children.length - 1; i >= 0; i--) {\n            const obj = this.scene.children[i];\n            this.scene.remove(obj);\n        }\n    }\n\n    resetScore () {\n        this.scores = {\n            left: 0,\n            right: 0\n        };\n\n        // Dispatch score event\n        window.dispatchEvent(\n            new CustomEvent(\n                'score',\n                {detail: {side: 'left', scores: this.scores}}\n            )\n        );\n    }\n\n    newGame () {\n        // Clear\n        this.clear();\n\n        // Lightning\n        // TODO Better lightning\n        const light = new THREE.HemisphereLight(0xffffff, 0xffffff, 1);\n        this.scene.add(light);\n\n        // Physics\n        this.physics = new Physics(10);\n\n        // Field\n        this.field = new Field(this.physics.getWorld(), 0, 0, 22, 10);\n\n        // Players\n        this.players = [];\n\n        for (const index in this.playersConfig) {\n            const playerConfig = this.playersConfig[index];\n            const position = [playerConfig.position === 'left' ? -5 : 5, -4];\n            const color = playerConfig.position === 'left' ? 0xff0000 : 0x0000ff;\n\n            const blob = new Blob(this.physics.getWorld(), color, position);\n            const player = new Player(playerConfig.name, playerConfig.controls, playerConfig.position);\n\n            player.attachBlob(blob);\n            this.players.push(player);\n        }\n\n        // Ball\n        this.ball = new Ball(this.physics.getWorld(), 0xff000, [-5, 5]);\n\n        // Declare interactions between materials\n        this._declareMaterialsInteractions();\n\n        // Serving side\n        this.servingSide = 'left';\n\n        // Add all meshes to the scene\n        const meshes = [\n            ...this.field.getParts(),\n            ..._.map(this.players, (player) => player.getBlob().threeObject),\n            this.ball.threeObject\n        ];\n\n        for (const i in meshes) {\n            this.scene.add(meshes[i]);\n        }\n\n        if (this.paused) {\n            this.pause(false);\n        }\n\n        this.inProgress = true;\n    }\n\n    endGame () {\n        this.inProgress = false;\n\n        window.dispatchEvent(\n            new CustomEvent(\n                'endGame',\n                {detail: {message: `${_.invert(this.scores)[_.max(_.values(this.scores))]} player wins`}}\n            )\n        );\n    }\n\n    afterScoring (winSide) {\n        this.playingSide = null;\n        let resetObjects = true;\n\n        // Internal pause\n        this.pause(true);\n        this.lockPause = true;\n\n        if (winSide === this.servingSide) {\n            this.incrementScore(winSide);\n\n            // End of game\n            const maxScore = _.max(_.values(this.scores)),\n                minScore = _.min(_.values(this.scores));\n\n            if (maxScore >= this.rules.config.scoreToWin && maxScore - minScore > 1) {\n                this.endGame();\n                resetObjects = false;\n            }\n        } else {\n            this.servingSide = winSide;\n        }\n\n        // Dispatch score event\n        window.dispatchEvent(\n            new CustomEvent(\n                'score',\n                {detail: {side: winSide, scores: this.scores}}\n            )\n        );\n\n        if (resetObjects) {\n            // Reset objects\n            this.ball.moveTo([winSide === 'left' ? -5 : 5, 5]);\n\n            _.forEach(this.players, function (player) {\n                player.blob.moveTo([player.side === 'left' ? -5 : 5, -4]);\n            });\n\n            _.delay(function () {\n                this.lockPause = false;\n                this.pause(false);\n            }.bind(this), 1000);\n        }\n    }\n\n    pause (pause) {\n        if (this.lockPause) {\n            throw new Error('Pause is locked');\n        }\n\n        this.paused = !_.isUndefined(pause) ? Boolean(pause) : !this.paused;\n        return this.paused;\n    }\n\n    update (fixedTimeStep, deltaTime, maxSubSteps) {\n        if (this.paused || !this.inProgress) {\n            return;\n        }\n\n        this.applyRules();\n\n        for (const i in this.players) {\n            this.players[i].listenInput();\n            this.players[i].getBlob().physics();\n        }\n\n        this.ball.physics();\n        this.physics.step(fixedTimeStep, deltaTime, maxSubSteps);\n    }\n\n    applyRules () {\n        let winSide = null,\n            resetTouches = false;\n\n        // Ball touching ground\n        if (this.ball.isTouchingGround()) {\n            winSide = this.ball.threeObject.position.x > 0 ? 'left' : 'right';\n\n        // Counting maximum touches\n        } else {\n            _.forEach(this.players, function (player) {\n                if (player.getBlob().isTouchingBall()) {\n                    player.currentTouches++;\n\n                    if (player.side !== this.playingSide) {\n                        // Switching side, reset touches\n                        if (!_.isNull(this.playingSide)) {\n                            resetTouches = true;\n                        }\n\n                        this.playingSide = player.side;\n                    }\n                }\n\n                // Maximum touches reached\n                if (player.currentTouches > this.rules.config.maximumContactsAllowed) {\n                    winSide = player.side === 'right' ? 'left' : 'right';\n                    resetTouches = true;\n                }\n            }.bind(this));\n        }\n\n        // Reset touches count\n        if (resetTouches) {\n            _.forEach(this.players, function (player) {\n                player.currentTouches = 0;\n            });\n        }\n\n        // We have a winner for this round\n        if (winSide) {\n            this.afterScoring(winSide);\n        }\n    }\n\n    incrementScore (side) {\n        this.scores[side]++;\n    }\n\n    _declareMaterialsInteractions () {\n        const world = this.physics.getWorld();\n\n        _.each(this.players, (player) => {\n            // Interaction blob vs ball\n            world.addContactMaterial(\n                new p2.ContactMaterial(\n                    player.blob.material,\n                    this.ball.material,\n                    {\n                        friction: 0,\n                        restitution: 1.1\n                    }\n                )\n            );\n\n            // Interaction blob vs ground\n            world.addContactMaterial(\n                new p2.ContactMaterial(\n                    player.blob.material,\n                    this.field.materials[0],\n                    {\n                        friction: 2,\n                        restitution: 0\n                    }\n                )\n            );\n\n            // TODO Interaction blob vs walls/net\n        });\n\n        // Interaction ball vs ground/walls/net\n        _.each(this.field.materials, (material) => {\n            world.addContactMaterial(\n                new p2.ContactMaterial(\n                    this.ball.material,\n                    material,\n                    {\n                        friction: 0,\n                        restitution: 1\n                    }\n                )\n            );\n        });\n    }\n}\n","import _ from 'lodash';\nimport p2 from 'p2';\n\nexport default class Physics {\n    constructor (gravity) {\n        this.gravity = _.isNumber(gravity) ? gravity : 100;\n        this.world = null;\n\n        this.init();\n    }\n\n    init () {\n        this.world = new p2.World({\n            gravity: [0, -this.gravity]\n        });\n    }\n\n    getWorld () {\n        return this.world;\n    }\n\n    step (fixedTimeStep, deltaTime, maxSubSteps) {\n        this.world.step(fixedTimeStep, deltaTime, maxSubSteps);\n    }\n}\n","import _ from 'lodash';\nimport KeyboardState from './keyboardState';\n\nexport default class Player {\n    constructor (name, controls, side) {\n        this.name = name;\n        this.controls = controls;\n        this.side = side;\n        this.keyboard = new KeyboardState();\n        this.blob = null;\n        this.currentTouches = 0;\n    }\n\n    setControls (controls) {\n        _.forEach(controls, function (value, key) {\n            this.setControlForKey(key, value);\n        }.bind(this));\n    }\n\n    setControlForKey (key, keyBinding) {\n        if (_.isUndefined(this.controls[key])) {\n            throw new Error(\"This control does not exist\");\n        }\n\n        this.controls[key] = keyBinding;\n    }\n\n    getControlsAntagonistKey (key) {\n        const antagonists = {\n            'left': 'right',\n            'right': 'left'\n        };\n\n        return antagonists[key];\n    }\n\n    listenInput () {\n        let x = 0,\n            y = 0;\n\n        for (const key in this.controls) {\n            const control = this.controls[key],\n                antagonistControl = this.controls[this.getControlsAntagonistKey(key)];\n\n            if (\n                this.keyboard.pressed(control)\n                &&\n                (\n                    typeof antagonistControl === 'undefined' || !this.keyboard.pressed(antagonistControl)\n                )\n            ) {\n                switch (key) {\n                case 'up':\n                    y = 1;\n                    break;\n                case 'right':\n                    x = 1;\n                    break;\n                case 'left':\n                    x = -1;\n                    break;\n                }\n\n                this.moveBlob(x, y);\n            }\n        }\n    }\n\n    attachBlob (blob) {\n        this.blob = blob;\n    }\n\n    detachBlob () {\n        this.blob = null;\n    }\n\n    getBlob () {\n        return this.blob;\n    }\n\n    moveBlob (x, y) {\n        if (this.blob !== null) {\n            this.blob.move(x, y);\n        }\n    }\n}\n","import _ from 'lodash';\n\nexport default class Rules {\n    constructor (config) {\n        this.defaultConfig = {\n            maximumContactsAllowed: 3,\n            scoreToWin: 25\n        };\n        this.config = _.extend({}, this.defaultConfig, config);\n    }\n}\n","import _ from 'lodash';\nimport EventEmitter from './eventEmitter';\n\nexport default class ScreenManager extends EventEmitter {\n    constructor (screens, flashMessageElement, flashMessageTextElement) {\n        super();\n\n        _.forEach(screens, function (item) {\n            if (!(item instanceof HTMLElement)) {\n                throw new Error(\"Screen must be an instance of HTMLElement\");\n            }\n        });\n\n        if (!(flashMessageElement instanceof HTMLElement)) {\n            throw new Error(\"flashMessageElement must be an instance of HTMLElement\");\n        }\n\n        if (!(flashMessageTextElement instanceof HTMLElement)) {\n            throw new Error(\"flashMessageTextElement must be an instance of HTMLElement\");\n        }\n\n        this.screens = screens;\n        this.flashMessageElement = flashMessageElement;\n        this.flashMessageTextElement = flashMessageTextElement;\n        this.history = [];\n        this.listeners = {};\n    }\n\n    goTo (screen) {\n        this.displayScreen(screen);\n        this.history.push(screen);\n        return this;\n    }\n\n    goBack () {\n        const index = this.history.length - 2;\n\n        if (index >= 0) {\n            const previousScreen = this.history[index];\n            if (previousScreen) {\n                this.displayScreen(previousScreen);\n                this.history.pop();\n            }\n        }\n    }\n\n    getScreen (name) {\n        if (_.isUndefined(this.screens[name])) {\n            throw new Error(`Screen ${name} does not exist`);\n        }\n\n        return this.screens[name];\n    }\n\n    displayScreen (name) {\n        const screen = this.getScreen(name);\n\n        this.dispatch(name);\n        this.hide();\n        screen.style.display = 'block';\n    }\n\n    hide () {\n        _.forEach(this.screens, function (item) {\n            item.style.display = 'none';\n        });\n    }\n\n    displayFlashMessage (message, duration) {\n        this.flashMessageTextElement.textContent = message;\n        this.fadeIn(this.flashMessageElement);\n\n        setTimeout(function () {\n            this.fadeOut(this.flashMessageElement);\n        }.bind(this), duration ? duration : 2000);\n    }\n\n    fadeIn (el) {\n        el.style.display = 'block';\n        el.style.opacity = 0;\n\n        let last = +new Date();\n        const tick = function () {\n            el.style.opacity = +el.style.opacity + ((new Date() - last) / 400);\n            last = +new Date();\n\n            if (+el.style.opacity < 1) {\n                (window.requestAnimationFrame && requestAnimationFrame(tick)) || setTimeout(tick, 16);\n            }\n        };\n\n        tick();\n    }\n\n    fadeOut (el) {\n        el.style.display = 'block';\n        el.style.opacity = 1;\n\n        let last = +new Date();\n        const tick = function () {\n            el.style.opacity -= (new Date() - last) / 400;\n            last = +new Date();\n\n            if (+el.style.opacity > 0) {\n                (window.requestAnimationFrame && requestAnimationFrame(tick)) || setTimeout(tick, 16);\n            }\n        };\n\n        tick();\n    }\n}\n","import _ from 'lodash';\n\nexport default class Sound {\n    constructor (sources) {\n        this.sources = sources;\n        this.audio = null;\n        this.play = _.throttle(this._play.bind(this), 100, { leading: true });\n\n        this.init();\n    }\n\n    init () {\n        this.audio = document.createElement('audio');\n\n        for (let i = 0; i < this.sources.length; i++) {\n            const source = document.createElement('source');\n            source.src = this.sources[i];\n            this.audio.appendChild(source);\n        }\n    }\n\n    getAudio () {\n        return this.audio;\n    }\n\n    _play (restart) {\n        if (restart === true && this.audio.currentTime > 0) {\n            this.stop();\n        }\n\n        this.audio.play();\n    }\n\n    stop () {\n        this.audio.currentTime = 0;\n    }\n}\n"]}